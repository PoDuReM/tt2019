\documentclass[10pt,a4paper,oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{cmll}
\usepackage{enumerate}
\usepackage{stmaryrd}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\usepackage{proof}
\usepackage{url}
\usepackage{CJKutf8}
\newcommand{\gq}[1]{\texttt{<<}#1\texttt{>>}}
\newcommand{\ogq}[1]{\overline{\texttt{<<}#1\texttt{>>}}}
\begin{document}

\begin{center}{\Large\textsc{\textbf{Теоретические (``малые'') домашние задания}}}\\
             \it Теория типов, ИТМО, М3334-М3339, осень 2019 года\end{center}

\section*{Домашнее задание №1: <<знакомство с лямбда-исчислением>>}

\begin{enumerate}
\item Расставьте скобки:

\begin{enumerate}
\item $\lambda x.x\ x\ \lambda x.x\ x$
\item $(\lambda x.x\ x)\ \lambda x.x\ x$
\item $\lambda x.(x\ x)\ \lambda x.x\ x$
\item $\lambda f.\lambda x.f f f x$
\end{enumerate}

\item Проведите бета-редукции и приведите выражения к нормальной форме:

\begin{enumerate}
\item $(\lambda a.\lambda b.a)\ (\lambda a.\lambda b.a)\ (\lambda a.\lambda b.b)$
\item $(\lambda a.\lambda b.a)\ b$
\item $(\lambda f.\lambda x.f\ (f\ x))\ (\lambda f.\lambda x.f\ (f\ x))$
\end{enumerate}

\item Выразите следующие функции в лямбда-исчислении:

\begin{enumerate}
\item Or, Xor;
\item тернарная операция в Си (\verb!?:!);
\item isZero (T, если аргумент равен 0, иначе F);
\item isEven (T, если аргумент чётный);
\item умножение на 2;
\item умножение;
\item возведение в степень;
\item упорядоченная пара. К паре должны прилагаться три лямбда-выражения ($M$, $P_l$, $P_r$):
выражение $M$ по двум значениям строит упорядоченную пару, а выражения $P_l$ и $P_r$ возвращают
первый и второй элемент упорядоченной пары соответственно.

Убедитесь, что для ваших выражений выполнено $$P_l\ (M\ A\ B) \rightarrow_\beta \dots \rightarrow_\beta A$$ и 
$$P_r\ (M\ A\ B) \rightarrow_\beta \dots \rightarrow_\beta B$$
\item вычитание 1;
\item вычитание;
\item сравнение (<<меньше>>);
\item деление.
\end{enumerate}

\item Назовём бета-эквивалентностью транзитивное, рефлексивное и симметричное замыкание отношения
бета-редукции, будем записывать его как $(=_\beta)$. В частности, бета-эквивалентны те термы,
которые имеют одинаковую нормальную форму.
Также, нетрудно заметить следующее:
\begin{enumerate}
\item $And\ T\ F =_\beta F$;
\item $\Omega =_\beta \Omega$;
\item $(\lambda n.\lambda f.\lambda x.n\ f\ (f\ x))\ \overline{n\vphantom{n+1}} =_\beta \overline{n+1}$;
\item $a \ne_\beta b$.
\end{enumerate}

Мы будем говорить, что лямбда-выражение $E$ выражает функцию $f(x_1,\dots,x_k): \mathbb{N}_0^k \rightarrow \mathbb{N}_0$,
если при любых $x_1,\dots,x_k \in \mathbb{N}_0$
выполнено

$$E\ \overline{x_1}\ \dots\ \overline{x_k} =_\beta \overline{f(x_1,\dots,x_k)}$$

Какие функции выражают следующие выражения? Ответ обоснуйте.
\begin{enumerate}
\item $\lambda m.\lambda n.n\ m$;
\item $\lambda m.\lambda n.\lambda x.n\ (m\ x)$.
\end{enumerate}

\item \emph{Ненормализуемым} назовём лямбда-выражение, не имеющее нормальной формы,
то есть выражение, для которого нет конечной последовательности бета-редукций,
приводящей к нормальной форме.
\emph{Сильно нормализуемым} назовём лямбда-выражение, для которого не существует бесконечной
последовательности бета-редукций (любая последовательность бета-редукций неизбежно 
заканчивается нормальной формой, если её продолжать достаточно долго).
\emph{Слабо нормализуемым} назовём лямбда-выражение, которое имеет нормальную форму,
но существует бесконечная последовательность бета-редукций, которая не приводит его
в нормальную форму. Приведите примеры сильно нормализуемого, слабо нормализуемого и 
ненормализуемого лямбда-выражения.
\end{enumerate}

\section*{Домашнее задание №2: <<теорема Чёрча-Россера, Y-комбинатор>>}

\begin{enumerate}
\item \emph{Полное доказательство теоремы Чёрча-Россера.}
На лекции был представлен план доказательства теоремы, в котором необходимо заполнить
пустоты. 
\begin{enumerate}
\item Покажите, что отношение бета-редукции --- подотношение отношения параллельной бета-редукции.
В символической записи, $(\rightarrow_\beta) \subseteq (\rightrightarrows_\beta)$.
То есть, если $A \rightarrow_\beta B$, то $A \rightrightarrows_\beta B$.

\item Покажите, что каковы бы ни были термы $A$, $P$, $Q$ и переменная $x$, 
если выполнено $P \rightrightarrows_\beta Q$, то $A [x := P] \rightrightarrows_\beta A [x := Q]$.
Убедитесь, что это справедливо и если $x$ не входит свободно в $A$.

\item Покажите, что каковы бы ни были термы $A$, $B$, $P$, $Q$ и переменная $x$, 
если $A \rightrightarrows_\beta B$ и $P \rightrightarrows_\beta Q$, то 
$A[x := P] \rightrightarrows_\beta B[x := Q]$.

\item Покажите, что $(\rightrightarrows_\beta)$ обладает ромбовидным свойством.

\item \emph{Транзитивным и рефлексивным замыканием} отношения $R \subseteq U^2$ назовём такое отношение
$R^* \subseteq U^2$, что $(x,y) \in R^*$ тогда и только тогда, когда существует $n\in \mathbb{N}$ и последовательность
$a_1,\dots,a_n \in U$, что: $a_1 = x$, $a_n = y$ и $(a_i,a_{i+1}) \in R$.

Покажите, что если $R$ --- некоторое отношение,
обладающее ромбовидным свойством, то $R^*$ тоже обладает
ромбовидным свойством.
\item Покажите, что каковы бы ни были отношения $R$ и $S$, если $R \subseteq S$, то $R^* \subseteq S^*$. 
В частности, покажите, что $(\twoheadrightarrow_\beta) \subseteq (\rightrightarrows_\beta)^*$.

\item Покажите, что $(\rightrightarrows_\beta)^* \subseteq (\twoheadrightarrow_\beta)$
\end{enumerate}

На основании доказанных лемм несложно показать утверждение теоремы Чёрча-Россера: из последних пунктов следует, что
$(\rightrightarrows_\beta)^* = (\twoheadrightarrow_\beta)$, а из пункта (d) --- что это отношение обладает 
ромбовидным свойством. 

\item Реализуйте следующие функции с помощью $Y$-комбинатора, вычисляющие:
\begin{enumerate}
\item факториал числа;
\item $n$-е простое число;
\item функцию Аккермана;
\item частичный логарифм.
\end{enumerate}

\item \emph{Отмеченным объединением} множеств $L \uplus R$ назовём множество пар
$$U = \{ \langle 1, x \rangle\ |\ x \in L \} \cup \{ \langle 2, y \rangle\ |\ y \in R \}$$ 

Соответственно,
для данного множества мы можем определить три функции

\begin{tabular}{l|l|l}
  название & обозначение & определение\\
  \hline
  левая инъекция & $in_L: L \rightarrow U$ & $in_L (x) = \langle 1,x \rangle$\\
  правая инъекция & $in_R: R \rightarrow U$ & $in_R (x) = \langle 2,x \rangle$\\
  выбор & $Case: U \times (L \rightarrow X) \times (R \rightarrow X)\rightarrow X$ & 
    $ Case(u,f,g) = \left\{\begin{array}{ll}f(x), &\mbox{если $u=\langle 1,x\rangle$}\\
                             g(x), &\mbox{если $u=\langle 2,x\rangle$}
                     \end{array}\right.
   $
\end{tabular}

Говоря простыми словами, инъекции приписывают к значению цифру 1 или 2, получая значение
из множества $U$, а выбор, основываясь на приписанной цифре, применяет к значению
первую или вторую фукнцию.

Построим аналогичную конструкцию для типов. \emph{Типом-суммой} типов $L$ и $R$
(или, иначе, \emph{алгебраическим типом}) назовём тип данных $U$, 
хранящий значения либо типа $L$, либо типа $R$, причём всегда точно известно, какого именно 
(сравните с определением дизъюнкции в интуиционистской логике). 
С точки зрения теории множеств, множество значений типа $U$ --- отмеченное объединение множеств
значений типов $L$ и $R$.
Для этого типа существует три базовых операции: две инъекции и выбор. 
Данный тип данных довольно широко распространён, и присутствует в 
ограниченном объёме даже в языках Си и Паскаль.

Например, в языке Паскаль c возможно следующее определение (там данная конструкция называется
<<записью с вариантами>>):

\begin{verbatim}
type value: record 
    is_real: boolean;
    case is_real of
        false: (real_value: real);
        true:  (int_value: integer);
    end;
\end{verbatim}

Данная запись если \verb!is_real = true! содержит поле 
\verb!int_value!, а если \verb!false!~--- поле \verb!real_value!. Реализация данной структуры
предполагает, что оба эти поля расположены в одной памяти.

В языке Си аналогом этой структуры является объединение (\verb!union!), однако, явного поля для выбора
одного из вариантов там не предусмотрено. В языке Си++ довольно близким аналогом является
класс \verb!std::variant! --- <<безопасное>> объединение.

В лямбда-исчислении оказывается возможно реализовать эту конструкцию в чистом математическом
виде:

\begin{center}\begin{tabular}{l}
$In_L = \lambda x.\lambda f.\lambda g.f\ x$\\
$In_R = \lambda x.\lambda f.\lambda g.g\ x$\\
$Case = \lambda u.\lambda f.\lambda g.u\ f\ g$
\end{tabular}\end{center}

Также ещё заметим, что список можно представить, как алгебраический тип с двумя вариантами:
\begin{itemize}
\item \verb!Nil! (соответствует пустому списку)
\item \verb!Cons(h,t)! (соединение головы списка \verb!h! и хвоста \verb!t!)
\end{itemize}
В частности, можно записать список \verb![1,2,3]! как \verb!Cons(1,Cons(2,Cons(3,Nil)))!.

В лямбда-исчислении мы можем представить \verb!Cons(h,t)! как правую инъекцию упорядоченной
пары $\langle h,t\rangle$ (так
будем обозначать выражение $\lambda a.a\ h\ t$),
а \verb!Nil! --- как левую инъекцию любого значения, например, $F$. Тогда список \verb![1,2,3]! может быть представлен
следующим лямбда-выражением:
$$In_R\ \langle\overline{1}, In_R\ \langle\overline{2}, In_R\ \langle\overline{3},In_L\ F\rangle\rangle\rangle$$

\begin{enumerate}
\item Реализуйте конструкции $In_L$, $In_R$, $Case$ на языках Си, Паскаль и Си++ как можно
ближе к формальному определению.
\item Покажите, что $Case\ (In_L\ \overline{0})\ (\lambda x.p)\ (\lambda x.q) =_\beta p$ и 
                    $Case\ (In_R\ q)\ (\lambda x.p)\ (\lambda x.x) =_\beta q$.
\item Постройте лямбда-выражение, по чёрчевскому нумералу $\overline{n}$ возвращающее список \verb![1,2,3,...,n]!.
\item Постройте лямбда-выражение, по списку возвращающее его длину.
\item Постройте лямбда-выражение, суммирующее список чёрчевских нумералов.
\item Покажите, как реализовать алгебраический тип на $n$ вариантов.
\item Покажите, как реализовать обращение списка (функция должна вернуть список в обратном порядке).
\end{enumerate}

\item Чёрчевские нумералы соответствуют аксиоматике Пеано (числа записываются путём приписываний
штрихов --- прибавлений единиц). В частности поэтому вся арифметика с ними крайне медленная.
А можно ли реализовать их с использованием двоичной записи?

\begin{enumerate} 
\item Предложите, как можно реализовать <<логарифмические>> нумералы --- значения,
которые соответствовали бы двоичной записи чисел.
\item Определите операцию преобразования чёрчевского нумерала в логарифмический.
\item Определите операцию преобразования логарифмического нумерала в чёрчевский.
\item Определите операцию суммы логарифмических нумералов.
\item Определите операцию ограниченного вычитания единицы из логарифмического нумерала
(напомним, ограниченное вычитание возвращает 0, если вычитаемое больше уменьшаемого).
\end{enumerate}

\end{enumerate}

\section*{Домашнее задание №3: <<просто типизированное лямбда-исчисление>>}

\begin{enumerate}
\item На прошлой лекции определение параллельной бета-редукции было сформулировано неточно,
отчего следующее утверждение не могло быть доказано:

{\itshape Покажите, что каковы бы ни были термы $A$, $B$, $P$, $Q$ и переменная $x$, 
если $A \rightrightarrows_\beta B$ и $P \rightrightarrows_\beta Q$, то 
$A[x := P] \rightrightarrows_\beta B[x := Q]$.}

Однако, данное утверждение можно доказать, если переформулировать параллельную 
бета-редукцию так. $A \rightrightarrows_\beta B$, если:
\begin{enumerate}
\item $A=x$, $B=y$ и $x=y$
\item $A = P\ Q$, $B = R\ S$ и $P\rightrightarrows_\beta R$, $Q\rightrightarrows_\beta S$
\item $A = \lambda x.P$, $B = \lambda x.Q$ и $P\rightrightarrows_\beta Q$
\item $A = (\lambda x.P)\ Q$, $B = R [x := S]$ и $P\rightrightarrows_\beta R$, $Q\rightrightarrows_\beta S$
\end{enumerate}

В связи с этим:

\begin{enumerate}
\item Докажите утверждение из прошлого домашнего задания при заданном определении.
\item Обладает ли исходное отношение параллельной бета-редукции (заданное на прошлой лекции) ромбовидным свойством?
Возможно, вы можете привести для него контрпример?
\end{enumerate}

\item Покажите, что если $A\twoheadrightarrow_\beta B$ и $\vdash A:\alpha$, то $\vdash B:\alpha$.

\item Верно ли, что если $A\twoheadrightarrow_\beta B$ и $\vdash B:\alpha$, то $\vdash A:\alpha$?
Верно ли это свойство для исчисления по Чёрчу?

\item Покажите, что комбинатор $\Omega = (\lambda x.x\ x)\ (\lambda x.x\ x)$ не имеет типа.

\item Покажите, что никакое лямбда-выражение не имеет типа $((\alpha\rightarrow\beta)\rightarrow\alpha)\rightarrow\alpha$.

\item Докажите следующие утверждения в ИИВ и постройте соответствующие лямбда-выражения
согласно изоморфизму Карри-Ховарда:
\begin{enumerate}
\item $\vdash(\alpha\rightarrow\alpha)\rightarrow\alpha\rightarrow\alpha$
\item $\vdash\alpha\rightarrow\beta\rightarrow\beta$
\item $\vdash(\alpha\rightarrow\beta)\rightarrow\alpha\rightarrow\beta$
\item $\vdash(\alpha\rightarrow\alpha\rightarrow\beta)\rightarrow(\alpha\rightarrow\beta)$
\item $\vdash(\alpha\rightarrow\beta\rightarrow\gamma)\rightarrow(\beta\rightarrow\alpha\rightarrow\gamma)$
\item $\vdash(\alpha\rightarrow\beta)\rightarrow(\beta\rightarrow\gamma)\rightarrow(\alpha\rightarrow\gamma)$
(аналог контрапозиции)
\end{enumerate}

\item Каков тип лямбда-выражения для суммы двух чёрчевских нумералов? Ответ поясните.

\item Заметим, что:
$$\begin{array}{l}
\vdash S : (\alpha\rightarrow\beta\rightarrow\gamma)\rightarrow(\alpha\rightarrow\beta)\rightarrow(\alpha\rightarrow\gamma)\\
\vdash K : \alpha\rightarrow\beta\rightarrow\alpha\end{array}$$

Как несложно заметить, данные утверждения соответствуют (в смысле изоморфизма Карри-Ховарда) 
схемам аксиом для импликационного фрагмента интуиционистского исчисления высказываний в гильбертовском стиле.
Значит, и доказательство утверждений может быть (согласно изоморфизму) перенесено в лямбда-исчисление.

Гильбертовский стиль, который мы использовали в курсе матлогики, предполагал плоский список высказываний
и номера утверждений для подсказок.
Однако, мы можем изображать эти доказательства и в виде дерева:

%a->a->a
%a->(a->a)->a
%(a->(a->a)->a)->(a->a->a)->(a->a)
%(a->a->a)->(a->a)

$$\infer{\alpha\rightarrow\alpha}
{\alpha\rightarrow\alpha\rightarrow\alpha &
   \infer{(\alpha\rightarrow\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)}
         { \alpha\rightarrow(\alpha\rightarrow\alpha)\rightarrow\alpha &
          (\alpha\rightarrow(\alpha\rightarrow\alpha)\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)
         }
}$$

Давайте теперь изобразим вывод типа (для экономии места мы не указываем вывод типов для комбинаторов
S и K).

$$\infer{\vdash S\ K\ K : \alpha\rightarrow\alpha}
{\vdash K:\alpha\rightarrow\alpha\rightarrow\alpha &
   \infer{\vdash S\ K: (\alpha\rightarrow\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)}
         {\vdash K : \alpha\rightarrow(\alpha\rightarrow\alpha)\rightarrow\alpha &
          \vdash S : (\alpha\rightarrow(\alpha\rightarrow\alpha)\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)
         }
}$$

Осталось заметить, что действительно $I =_\beta S\ K\ K$.

На основе изложенного, постройте доказательства следующих утверждений в гильбертовском стиле и
выразите соответствующие выражения с помощью комбинаторов $S$ и $K$:

\begin{enumerate}
\item $\alpha\rightarrow\beta\rightarrow\beta$
\item $(\alpha\rightarrow\beta)\rightarrow\alpha\rightarrow\beta$
\item $(\alpha\rightarrow\alpha\rightarrow\beta)\rightarrow(\alpha\rightarrow\beta)$
\item $(\alpha\rightarrow\beta\rightarrow\gamma)\rightarrow(\beta\rightarrow\alpha\rightarrow\gamma)$
\end{enumerate}

\item В дополнение к базису $SK$ рассмотрим базис $BCKW$: 
$$\begin{array}{l}B = \lambda x.\lambda y.\lambda z.x\ (y\ z)\\
C = \lambda x.\lambda y.\lambda z.x\ z\ y\\
K = \lambda x.\lambda y.x\\
W = \lambda x.\lambda y.x\ y\ y\end{array}$$

Выведите типы для данных комбинаторов, постройте схемы аксиом для соответствующего гильбертовского исчисления
высказываний и покажите, что данное исчисление также позволяет доказать любое утверждение из импликационного
фрагмента ИИВ.

\end{enumerate}
\end{document}
                  